{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport axios from \"axios\";\n\n// 创建一个axios对象出来\nconst request = axios.create({\n  baseURL: \"http://8.138.124.114:9766/sparrow/api\",\n  timeout: 60000\n});\n\n// request 拦截器\n// 可以自请求发送前对请求做一些处理\n// 比如统一加token，对请求参数统一加密\nrequest.interceptors.request.use(config => {\n  // 只有未设置 Content-Type 的请求才设置默认值\n  if (!config.headers[\"Content-Type\"] && !(config.data instanceof FormData)) {\n    config.headers[\"Content-Type\"] = \"application/json;charset=utf-8\";\n  }\n  // 从本地存储中获取 accessToken\n  const accessToken = localStorage.getItem(\"accessToken\");\n  const accessToken2 = localStorage.getItem(\"templeAccessToken\"); //临时token\n\n  if (config.url.includes(\"/users/loginByPassword\") || config.url.includes(\"/users/loginByEmail\") || config.url.includes(\"/users/email\") || config.url.includes(\"/users/verify\")) {\n    // 无需设置token请求头\n    return config;\n  }\n  if (config.url.includes(\"/users/resetPassword\") && accessToken2) {\n    //忘记密码需要一个临时token\n    config.headers[\"accessToken\"] = `${accessToken2}`; //后端要求为accessToken\n    return config;\n  }\n  if (accessToken) config.headers[\"accessToken\"] = `${accessToken}`; //后端要求为accessToken\n\n  return config;\n}, error => {\n  return Promise.reject(error);\n});\n\n// response 拦截器\n// 可以在接口响应后统一处理结果\nlet isRefreshing = false;\nlet requests = [];\nrequest.interceptors.response.use(response => {\n  // response.data即为后端返回的Result\n  let res = response.data;\n  // 兼容服务端返回的字符串数据\n  if (typeof res === \"string\") {\n    res = res ? JSON.parse(res) : res;\n  }\n  return res;\n}, async error => {\n  const {\n    config,\n    response\n  } = error;\n  if (response && response.status === 401) {\n    if (!isRefreshing) {\n      isRefreshing = true;\n      try {\n        // 从本地存储中获取 refreshToken\n        const refreshToken = localStorage.getItem(\"refreshToken\");\n        if (refreshToken) {\n          // 发送刷新 token 的请求\n          const refreshResponse = await axios.post(`${request.defaults.baseURL}/user/refresh`, {\n            refreshToken\n          });\n          const {\n            accessToken,\n            refreshToken: newRefreshToken\n          } = refreshResponse.data;\n          // 更新本地存储的 token\n          localStorage.setItem(\"accessToken\", accessToken);\n          if (newRefreshToken) {\n            localStorage.setItem(\"refreshToken\", newRefreshToken);\n          }\n          // 重新发起之前失败的请求\n          requests.forEach(cb => cb(accessToken));\n          requests = [];\n          return request(config);\n        }\n      } catch (refreshError) {\n        // 刷新 token 失败，清除本地存储的 token 并跳转到登录页\n        localStorage.removeItem(\"accessToken\");\n        localStorage.removeItem(\"refreshToken\");\n        // 这里需要根据你的项目实际情况进行跳转登录页的操作\n        // 例如在 Vue 项目中可以使用 this.$router.push('/login')\n        console.log(\"刷新 token 失败，跳转到登录页\");\n        return Promise.reject(refreshError);\n      } finally {\n        isRefreshing = false;\n      }\n    } else {\n      // 正在刷新 token，将请求挂起\n      return new Promise(resolve => {\n        requests.push(accessToken => {\n          config.headers[\"Authorization\"] = `${accessToken}`;\n          resolve(request(config));\n        });\n      });\n    }\n  }\n  if (response && response.data.msg === \"用户未登录\") {\n    // 这里需要根据你的项目实际情况进行跳转登录页的操作\n    // 例如在 Vue 项目中可以使用 this.$router.push('/login')\n    console.log(\"用户未登录，跳转到登录页\");\n    localStorage.removeItem(\"accessToken\");\n    localStorage.removeItem(\"refreshToken\");\n    return Promise.reject(error);\n  }\n  console.log(\"err\" + error); // for debug\n  return Promise.reject(error);\n});\nexport default request;","map":{"version":3,"names":["axios","request","create","baseURL","timeout","interceptors","use","config","headers","data","FormData","accessToken","localStorage","getItem","accessToken2","url","includes","error","Promise","reject","isRefreshing","requests","response","res","JSON","parse","status","refreshToken","refreshResponse","post","defaults","newRefreshToken","setItem","forEach","cb","refreshError","removeItem","console","log","resolve","push","msg"],"sources":["C:/Users/NNNaR/Desktop/短链/ShortLink-FrontEnd/vue/src/utils/request.js"],"sourcesContent":["import axios from \"axios\";\r\n\r\n// 创建一个axios对象出来\r\nconst request = axios.create({\r\n  baseURL: \"http://8.138.124.114:9766/sparrow/api\",\r\n  timeout: 60000,\r\n});\r\n\r\n// request 拦截器\r\n// 可以自请求发送前对请求做一些处理\r\n// 比如统一加token，对请求参数统一加密\r\nrequest.interceptors.request.use(\r\n  (config) => {\r\n    // 只有未设置 Content-Type 的请求才设置默认值\r\n    if (!config.headers[\"Content-Type\"] && !(config.data instanceof FormData)) {\r\n      config.headers[\"Content-Type\"] = \"application/json;charset=utf-8\";\r\n    }\r\n    // 从本地存储中获取 accessToken\r\n    const accessToken = localStorage.getItem(\"accessToken\");\r\n    const accessToken2 = localStorage.getItem(\"templeAccessToken\"); //临时token\r\n\r\n    if (\r\n      config.url.includes(\"/users/loginByPassword\") ||\r\n      config.url.includes(\"/users/loginByEmail\") ||\r\n      config.url.includes(\"/users/email\") ||\r\n      config.url.includes(\"/users/verify\")\r\n    ) {\r\n      // 无需设置token请求头\r\n      return config;\r\n    }\r\n\r\n    if (config.url.includes(\"/users/resetPassword\") && accessToken2) {\r\n      //忘记密码需要一个临时token\r\n      config.headers[\"accessToken\"] = `${accessToken2}`; //后端要求为accessToken\r\n      return config;\r\n    }\r\n\r\n    if (accessToken) config.headers[\"accessToken\"] = `${accessToken}`; //后端要求为accessToken\r\n\r\n    return config;\r\n  },\r\n  (error) => {\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\n// response 拦截器\r\n// 可以在接口响应后统一处理结果\r\nlet isRefreshing = false;\r\nlet requests = [];\r\n\r\nrequest.interceptors.response.use(\r\n  (response) => {\r\n    // response.data即为后端返回的Result\r\n    let res = response.data;\r\n    // 兼容服务端返回的字符串数据\r\n    if (typeof res === \"string\") {\r\n      res = res ? JSON.parse(res) : res;\r\n    }\r\n    return res;\r\n  },\r\n  async (error) => {\r\n    const { config, response } = error;\r\n    if (response && response.status === 401) {\r\n      if (!isRefreshing) {\r\n        isRefreshing = true;\r\n        try {\r\n          // 从本地存储中获取 refreshToken\r\n          const refreshToken = localStorage.getItem(\"refreshToken\");\r\n          if (refreshToken) {\r\n            // 发送刷新 token 的请求\r\n            const refreshResponse = await axios.post(\r\n              `${request.defaults.baseURL}/user/refresh`,\r\n              {\r\n                refreshToken,\r\n              }\r\n            );\r\n            const { accessToken, refreshToken: newRefreshToken } =\r\n              refreshResponse.data;\r\n            // 更新本地存储的 token\r\n            localStorage.setItem(\"accessToken\", accessToken);\r\n            if (newRefreshToken) {\r\n              localStorage.setItem(\"refreshToken\", newRefreshToken);\r\n            }\r\n            // 重新发起之前失败的请求\r\n            requests.forEach((cb) => cb(accessToken));\r\n            requests = [];\r\n            return request(config);\r\n          }\r\n        } catch (refreshError) {\r\n          // 刷新 token 失败，清除本地存储的 token 并跳转到登录页\r\n          localStorage.removeItem(\"accessToken\");\r\n          localStorage.removeItem(\"refreshToken\");\r\n          // 这里需要根据你的项目实际情况进行跳转登录页的操作\r\n          // 例如在 Vue 项目中可以使用 this.$router.push('/login')\r\n          console.log(\"刷新 token 失败，跳转到登录页\");\r\n          return Promise.reject(refreshError);\r\n        } finally {\r\n          isRefreshing = false;\r\n        }\r\n      } else {\r\n        // 正在刷新 token，将请求挂起\r\n        return new Promise((resolve) => {\r\n          requests.push((accessToken) => {\r\n            config.headers[\"Authorization\"] = `${accessToken}`;\r\n            resolve(request(config));\r\n          });\r\n        });\r\n      }\r\n    }\r\n    if (response && response.data.msg === \"用户未登录\") {\r\n      // 这里需要根据你的项目实际情况进行跳转登录页的操作\r\n      // 例如在 Vue 项目中可以使用 this.$router.push('/login')\r\n      console.log(\"用户未登录，跳转到登录页\");\r\n      localStorage.removeItem(\"accessToken\");\r\n      localStorage.removeItem(\"refreshToken\");\r\n      return Promise.reject(error);\r\n    }\r\n    console.log(\"err\" + error); // for debug\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport default request;\r\n"],"mappings":";;;AAAA,OAAOA,KAAK,MAAM,OAAO;;AAEzB;AACA,MAAMC,OAAO,GAAGD,KAAK,CAACE,MAAM,CAAC;EAC3BC,OAAO,EAAE,uCAAuC;EAChDC,OAAO,EAAE;AACX,CAAC,CAAC;;AAEF;AACA;AACA;AACAH,OAAO,CAACI,YAAY,CAACJ,OAAO,CAACK,GAAG,CAC7BC,MAAM,IAAK;EACV;EACA,IAAI,CAACA,MAAM,CAACC,OAAO,CAAC,cAAc,CAAC,IAAI,EAAED,MAAM,CAACE,IAAI,YAAYC,QAAQ,CAAC,EAAE;IACzEH,MAAM,CAACC,OAAO,CAAC,cAAc,CAAC,GAAG,gCAAgC;EACnE;EACA;EACA,MAAMG,WAAW,GAAGC,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC;EACvD,MAAMC,YAAY,GAAGF,YAAY,CAACC,OAAO,CAAC,mBAAmB,CAAC,CAAC,CAAC;;EAEhE,IACEN,MAAM,CAACQ,GAAG,CAACC,QAAQ,CAAC,wBAAwB,CAAC,IAC7CT,MAAM,CAACQ,GAAG,CAACC,QAAQ,CAAC,qBAAqB,CAAC,IAC1CT,MAAM,CAACQ,GAAG,CAACC,QAAQ,CAAC,cAAc,CAAC,IACnCT,MAAM,CAACQ,GAAG,CAACC,QAAQ,CAAC,eAAe,CAAC,EACpC;IACA;IACA,OAAOT,MAAM;EACf;EAEA,IAAIA,MAAM,CAACQ,GAAG,CAACC,QAAQ,CAAC,sBAAsB,CAAC,IAAIF,YAAY,EAAE;IAC/D;IACAP,MAAM,CAACC,OAAO,CAAC,aAAa,CAAC,GAAG,GAAGM,YAAY,EAAE,CAAC,CAAC;IACnD,OAAOP,MAAM;EACf;EAEA,IAAII,WAAW,EAAEJ,MAAM,CAACC,OAAO,CAAC,aAAa,CAAC,GAAG,GAAGG,WAAW,EAAE,CAAC,CAAC;;EAEnE,OAAOJ,MAAM;AACf,CAAC,EACAU,KAAK,IAAK;EACT,OAAOC,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC;AAC9B,CACF,CAAC;;AAED;AACA;AACA,IAAIG,YAAY,GAAG,KAAK;AACxB,IAAIC,QAAQ,GAAG,EAAE;AAEjBpB,OAAO,CAACI,YAAY,CAACiB,QAAQ,CAAChB,GAAG,CAC9BgB,QAAQ,IAAK;EACZ;EACA,IAAIC,GAAG,GAAGD,QAAQ,CAACb,IAAI;EACvB;EACA,IAAI,OAAOc,GAAG,KAAK,QAAQ,EAAE;IAC3BA,GAAG,GAAGA,GAAG,GAAGC,IAAI,CAACC,KAAK,CAACF,GAAG,CAAC,GAAGA,GAAG;EACnC;EACA,OAAOA,GAAG;AACZ,CAAC,EACD,MAAON,KAAK,IAAK;EACf,MAAM;IAAEV,MAAM;IAAEe;EAAS,CAAC,GAAGL,KAAK;EAClC,IAAIK,QAAQ,IAAIA,QAAQ,CAACI,MAAM,KAAK,GAAG,EAAE;IACvC,IAAI,CAACN,YAAY,EAAE;MACjBA,YAAY,GAAG,IAAI;MACnB,IAAI;QACF;QACA,MAAMO,YAAY,GAAGf,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC;QACzD,IAAIc,YAAY,EAAE;UAChB;UACA,MAAMC,eAAe,GAAG,MAAM5B,KAAK,CAAC6B,IAAI,CACtC,GAAG5B,OAAO,CAAC6B,QAAQ,CAAC3B,OAAO,eAAe,EAC1C;YACEwB;UACF,CACF,CAAC;UACD,MAAM;YAAEhB,WAAW;YAAEgB,YAAY,EAAEI;UAAgB,CAAC,GAClDH,eAAe,CAACnB,IAAI;UACtB;UACAG,YAAY,CAACoB,OAAO,CAAC,aAAa,EAAErB,WAAW,CAAC;UAChD,IAAIoB,eAAe,EAAE;YACnBnB,YAAY,CAACoB,OAAO,CAAC,cAAc,EAAED,eAAe,CAAC;UACvD;UACA;UACAV,QAAQ,CAACY,OAAO,CAAEC,EAAE,IAAKA,EAAE,CAACvB,WAAW,CAAC,CAAC;UACzCU,QAAQ,GAAG,EAAE;UACb,OAAOpB,OAAO,CAACM,MAAM,CAAC;QACxB;MACF,CAAC,CAAC,OAAO4B,YAAY,EAAE;QACrB;QACAvB,YAAY,CAACwB,UAAU,CAAC,aAAa,CAAC;QACtCxB,YAAY,CAACwB,UAAU,CAAC,cAAc,CAAC;QACvC;QACA;QACAC,OAAO,CAACC,GAAG,CAAC,oBAAoB,CAAC;QACjC,OAAOpB,OAAO,CAACC,MAAM,CAACgB,YAAY,CAAC;MACrC,CAAC,SAAS;QACRf,YAAY,GAAG,KAAK;MACtB;IACF,CAAC,MAAM;MACL;MACA,OAAO,IAAIF,OAAO,CAAEqB,OAAO,IAAK;QAC9BlB,QAAQ,CAACmB,IAAI,CAAE7B,WAAW,IAAK;UAC7BJ,MAAM,CAACC,OAAO,CAAC,eAAe,CAAC,GAAG,GAAGG,WAAW,EAAE;UAClD4B,OAAO,CAACtC,OAAO,CAACM,MAAM,CAAC,CAAC;QAC1B,CAAC,CAAC;MACJ,CAAC,CAAC;IACJ;EACF;EACA,IAAIe,QAAQ,IAAIA,QAAQ,CAACb,IAAI,CAACgC,GAAG,KAAK,OAAO,EAAE;IAC7C;IACA;IACAJ,OAAO,CAACC,GAAG,CAAC,cAAc,CAAC;IAC3B1B,YAAY,CAACwB,UAAU,CAAC,aAAa,CAAC;IACtCxB,YAAY,CAACwB,UAAU,CAAC,cAAc,CAAC;IACvC,OAAOlB,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC;EAC9B;EACAoB,OAAO,CAACC,GAAG,CAAC,KAAK,GAAGrB,KAAK,CAAC,CAAC,CAAC;EAC5B,OAAOC,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC;AAC9B,CACF,CAAC;AAED,eAAehB,OAAO","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import { ref, onMounted } from \"vue\";\nimport { ElMessage } from \"element-plus\";\nimport { Warning, Loading } from \"@element-plus/icons-vue\";\n\n// 获取短链参数\n\nexport default {\n  __name: 'Password',\n  setup(__props) {\n    const getShortCode = () => {\n      const params = new URLSearchParams(window.location.search);\n      return params.get(\"short\") || \"\";\n    };\n\n    // 页面状态\n    const loading = ref(true);\n    const needPassword = ref(false);\n    const error = ref(false);\n    const errorMessage = ref(\"\");\n    const password = ref(\"\");\n    const submitting = ref(false);\n\n    // 检查短链状态\n    const checkLink = async () => {\n      try {\n        const response = await fetch(`/api/check-password?short=${getShortCode()}`);\n        const data = await response.json();\n        if (data.needPassword) {\n          needPassword.value = true;\n        } else {\n          // 直接跳转\n          window.open(data.originalUrl, \"_self\");\n        }\n      } catch (err) {\n        error.value = true;\n        errorMessage.value = \"链接验证失败，请刷新重试\";\n      } finally {\n        loading.value = false;\n      }\n    };\n\n    // 提交密码验证\n    const handleSubmit = async () => {\n      if (!password.value) {\n        ElMessage.warning(\"请输入访问密码\");\n        return;\n      }\n      submitting.value = true;\n      try {\n        const response = await fetch(\"/api/validate-password\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          body: JSON.stringify({\n            short: getShortCode(),\n            password: password.value\n          })\n        });\n        const data = await response.json();\n        if (data.valid) {\n          window.open(data.originalUrl, \"_blank\");\n        } else {\n          ElMessage.error(\"密码验证失败\");\n        }\n      } catch (err) {\n        ElMessage.error(\"验证请求失败\");\n      } finally {\n        submitting.value = false;\n      }\n    };\n\n    // 生命周期钩子\n    onMounted(() => {\n      if (!getShortCode()) {\n        error.value = true;\n        errorMessage.value = \"缺少短链参数\";\n        loading.value = false;\n        return;\n      }\n      checkLink();\n    });\n    return {\n      __sfc: true,\n      getShortCode,\n      loading,\n      needPassword,\n      error,\n      errorMessage,\n      password,\n      submitting,\n      checkLink,\n      handleSubmit,\n      Warning,\n      Loading\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","ElMessage","Warning","Loading","getShortCode","params","URLSearchParams","window","location","search","get","loading","needPassword","error","errorMessage","password","submitting","checkLink","response","fetch","data","json","value","open","originalUrl","err","handleSubmit","warning","method","headers","body","JSON","stringify","short","valid"],"sources":["Password.vue"],"sourcesContent":["<template>\r\n  <div class=\"redirect-container\">\r\n    <!-- 加载状态 -->\r\n    <div v-if=\"loading\" class=\"status-box\">\r\n      <el-icon class=\"loading-icon\"><Loading /></el-icon>\r\n      <p>正在验证链接...</p>\r\n    </div>\r\n\r\n    <!-- 密码输入表单 -->\r\n    <div v-else-if=\"needPassword\" class=\"password-form\">\r\n      <h2>该链接需要访问密码</h2>\r\n      <el-form @submit.prevent=\"handleSubmit\">\r\n        <el-form-item label=\"访问密码\">\r\n          <el-input\r\n            v-model=\"password\"\r\n            type=\"password\"\r\n            placeholder=\"请输入访问密码\"\r\n            show-password\r\n          ></el-input>\r\n        </el-form-item>\r\n        <el-button type=\"primary\" @click=\"handleSubmit\" :loading=\"submitting\">\r\n          验证密码\r\n        </el-button>\r\n      </el-form>\r\n    </div>\r\n\r\n    <!-- 错误提示 -->\r\n    <div v-else-if=\"error\" class=\"error-box\">\r\n      <el-icon color=\"#F56C6C\"><Warning /></el-icon>\r\n      <p>{{ errorMessage }}</p>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from \"vue\";\r\nimport { ElMessage } from \"element-plus\";\r\nimport { Warning, Loading } from \"@element-plus/icons-vue\";\r\n\r\n// 获取短链参数\r\nconst getShortCode = () => {\r\n  const params = new URLSearchParams(window.location.search);\r\n  return params.get(\"short\") || \"\";\r\n};\r\n\r\n// 页面状态\r\nconst loading = ref(true);\r\nconst needPassword = ref(false);\r\nconst error = ref(false);\r\nconst errorMessage = ref(\"\");\r\nconst password = ref(\"\");\r\nconst submitting = ref(false);\r\n\r\n// 检查短链状态\r\nconst checkLink = async () => {\r\n  try {\r\n    const response = await fetch(`/api/check-password?short=${getShortCode()}`);\r\n    const data = await response.json();\r\n\r\n    if (data.needPassword) {\r\n      needPassword.value = true;\r\n    } else {\r\n      // 直接跳转\r\n      window.open(data.originalUrl, \"_self\");\r\n    }\r\n  } catch (err) {\r\n    error.value = true;\r\n    errorMessage.value = \"链接验证失败，请刷新重试\";\r\n  } finally {\r\n    loading.value = false;\r\n  }\r\n};\r\n\r\n// 提交密码验证\r\nconst handleSubmit = async () => {\r\n  if (!password.value) {\r\n    ElMessage.warning(\"请输入访问密码\");\r\n    return;\r\n  }\r\n\r\n  submitting.value = true;\r\n  try {\r\n    const response = await fetch(\"/api/validate-password\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify({\r\n        short: getShortCode(),\r\n        password: password.value,\r\n      }),\r\n    });\r\n\r\n    const data = await response.json();\r\n    if (data.valid) {\r\n      window.open(data.originalUrl, \"_blank\");\r\n    } else {\r\n      ElMessage.error(\"密码验证失败\");\r\n    }\r\n  } catch (err) {\r\n    ElMessage.error(\"验证请求失败\");\r\n  } finally {\r\n    submitting.value = false;\r\n  }\r\n};\r\n\r\n// 生命周期钩子\r\nonMounted(() => {\r\n  if (!getShortCode()) {\r\n    error.value = true;\r\n    errorMessage.value = \"缺少短链参数\";\r\n    loading.value = false;\r\n    return;\r\n  }\r\n  checkLink();\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.redirect-container {\r\n  max-width: 600px;\r\n  margin: 100px auto;\r\n  padding: 20px;\r\n  text-align: center;\r\n}\r\n\r\n.status-box {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  gap: 20px;\r\n}\r\n\r\n.loading-icon {\r\n  font-size: 40px;\r\n  animation: rotating 2s linear infinite;\r\n}\r\n\r\n.password-form {\r\n  padding: 30px;\r\n  background: #f8f9fa;\r\n  border-radius: 8px;\r\n  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.error-box {\r\n  color: #f56c6c;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 10px;\r\n}\r\n\r\n@keyframes rotating {\r\n  from {\r\n    transform: rotate(0deg);\r\n  }\r\n  to {\r\n    transform: rotate(360deg);\r\n  }\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}